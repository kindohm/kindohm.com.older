---
layout: post
title: "Multi Video Capture in Silverlight"
---

<p><a href="http://kindohm.com/doublecam/" target="_blank">Try the demo application</a></p>
































































  
<p><a href="http://kindohm.com/doublecam/DoubleCam.zip" target="_blank">Download source code</a></p>
































































  
<p><img src="/hodsmedia/832399937_1.png" alt=""/></p>
































































  
<p>One fine detail before you read any further: you need to have two video capture devices (e.g. web cams) in order to really have any fun with this.</p>
































































  
<p>One of the best features about Silverlight 4 is that you can interact with video and audio capture devices. This enables you to take pictures from a web cam, record video, or record audio in your Silverlight application and handle the media data directly.</p>
































































  
<p>One fun little side effect of the video capture API in Silverlight 4 is that you can enable two video capture devices simultaneously. This may or may not have any value to you and your everyday Silverlight programming, but if it did then it probably wouldn&#8217;t be any fun anyway!</p>
































































  
<p>If you haven&#8217;t tried out the Audio/Video capture API in Silverlight 4 yet, here is the basic idea:</p>
































































  <script src="http://gist.github.com/480674.js?file=capture.cs"></script>
<p>That&#8217;s all the code you need to do to start viewing/recording video. Basically, CaptureSource is the key class that makes it all work for you. You use CaptureSource&#8217;s VideoCaptureDevice property to tell it which video device on your computer to use. You may have more than one, but Silverlight lets you select a default one with the CaptureDeviceConfiguration class&#8217;s GetDefaultVideoCaptureDevice method.  It&#8217;s cake.</p>
































































  
<p>If you actually want to select a specific video device and not use the default, you can use the CaptureDeviceConfiguration&#8217;s GetAvailableVideoCaptureDevices method:</p>
































































  <script src="http://gist.github.com/480681.js?file=getdevices.cs"></script>
<p>With that list of devices you can bind to it or do whatever it is you like to do with lists of VideoCaptureDevices. Typically, I bind that list to a ComboBox so that the user can select their device.</p>
































































  
<p>To display the video from your device on screen, call the Start() method on the CaptureSource object and use a video brush to paint it onto a surface, like a rectangle:</p>
































































  <script src="http://gist.github.com/480687.js?file=allowaccess.cs"></script>
<p>In the source code for this article you can see this all in action.</p>
































































  
<p>Now, the cool part is that you can encapsulate all of the above logic in a Silverlight UserControl and display two cameras at the same time. Essentially, two CaptureSource objects can be set up and started.</p>
































































  
<p>As an example, I have a main page with two Camera user controls I created on it:</p>
































































  <script src="http://gist.github.com/480690.js?file=MainPage.xaml"></script>
<p>And the camera controls look like this:</p>
































































  <script src="http://gist.github.com/480692.js?file=camera.xaml"></script>
<p>You can see that I&#8217;ve added a Rectangle for the video display area, a Combo box to let the user select their device, a &#8220;Turn On&#8221; button, and a warning message to display (if necessary) about the device already being in use.</p>
































































  
<p>CaptureSource.Start() will throw an InvalidOperationException if the same device is selected twice (once in each Camera control). I&#8217;m catching that exception and then displaying the &#8220;already in use&#8221; warning message when that scenario occurs.</p>
































































  
<p>When I run the application, I can select two different cameras and display them at the same time:</p>
































































  
<p><img src="/hodsmedia/832399937_2.png" alt=""/></p>
































































  
<p>You&#8217;ll receive the following error if you select a device that is already in use:</p>
































































  
<p><img src="/hodsmedia/832399937_3.png" alt=""/></p>
































































  
<p>Again, what is the point?  Well, I&#8217;ll leave that up to you. Theoretically the ability to run two video devices in Silverlight would allow you to, say, take pictures of yourself with one device while scanning barcodes with the other. I do that all the time. Kidding!  Geez!</p>
































































  
<p>Another interesting example is that you can achieve a composite image by layering one visual element with less than full opacity over another element - and have both elements use VisualBrushes that pull from different video sources:</p>
































































  
<p><img src="/hodsmedia/832399937_4.png" alt=""/></p>
































































  
<p>I&#8217;ve just spawned a whole new genre of visual art&#8230;</p>
































































  
<p>One &#8220;gotcha!&#8221; of using two web cams at the same time is that your browser and operating system might not be too happy with you. If you are constantly starting capture sources, debugging without stopping devices, plugging in and removing devices, and testing multiple browsers, you may experience a &#8220;hang&#8221; (or &#8220;crash&#8221;) in your Silverlight app when you call CaptureSource.Start().</p>
































































  
<p>You can reproduce this problem in the Silverlight configuration tool. Right-click on your application, choose Silverlight, then choose the Webcam/Mic tab. In a crash-free scenario, your config tool will show this:</p>
































































  
<p><img src="/hodsmedia/832399937_5.png" alt=""/></p>
































































  
<p>In a scenario when your operating system and Silverlight can&#8217;t communicate with your video capture devices, the above tab will &#8220;hang&#8221; indefinitely and not display anything.</p>
































































  
<p>To help minimize this problem with hangs and crashing, I encourage you to stop all CaptureSources when the application exits. This seems to make all those web cams and Silverlight play more happily together:</p>
































































  <script src="http://gist.github.com/481539.js?file=stopall.cs"></script>
<p>That&#8217;s it. If anything, playing with multiple capture devices simultaneously is just good clean fun. Since <em>audio</em> capture is very similar to video capture in Silverlight, you could probably do some crazy stereo imaging or something with audio capture using these techniques (I smell another blog post coming&#8230;).</p>
































































  
<p>Have fun and enjoy!</p>
































































